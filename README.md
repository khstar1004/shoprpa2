# ShopRPA - 상품 데이터 크롤링 및 매칭 시스템

## 개요
ShopRPA는 네이버, 고기프트 등 다양한 쇼핑몰에서 상품 데이터를 크롤링하고 매칭하는 자동화 시스템입니다. 이미지 처리, 가격 비교, 데이터 정제 등 다양한 기능을 제공합니다.

## 주요 기능

### 1. 데이터 크롤링
- **네이버 쇼핑 API 크롤링** (`crawl_naver_api.py`)
  - 네이버 쇼핑 API를 통한 상품 검색
    - 키워드 변형을 통한 검색 최적화
    - 유사도 기반 결과 필터링
    - API 요청 제한 및 재시도 로직
  - 이미지 다운로드 및 배경 제거
    - 비동기 이미지 다운로드
    - 자동 배경 제거 처리
    - 이미지 캐싱 및 중복 방지
  - 수량별 가격 정보 추출
    - 판매자 사이트 방문 및 가격표 분석
    - 수량별 할인 정보 추출
    - VAT 포함 여부 확인
  - CAPTCHA 감지 및 처리
    - 자동 CAPTCHA 감지
    - 브라우저 자동화 우회
    - 요청 간격 최적화

- **고기프트 크롤링** (`crawling_kogift.py`)
  - 고기프트 사이트 상품 정보 수집
    - 동적 웹페이지 크롤링
    - 상품 상세 정보 추출
    - 가격 및 재고 정보 수집
  - 이미지 다운로드 및 처리
    - 고품질 이미지 다운로드
    - 이미지 포맷 변환
    - 메타데이터 추출
  - 가격 정보 추출
    - 수량별 가격 정보
    - 할인 정보
    - 배송비 정보

### 2. 이미지 처리
- **이미지 통합** (`image_integration.py`)
  - 다중 소스 이미지 통합
    - 해오름/고기프트/네이버 이미지 매칭
    - 이미지 유사도 기반 매칭
    - 중복 이미지 제거
  - 이미지 유사도 분석
    - GPU 가속 이미지 특성 추출
    - 딥러닝 기반 유사도 계산
    - 토큰 기반 텍스트 매칭
  - 배경 제거 처리
    - 자동 배경 제거
    - 이미지 품질 최적화
    - 캐시 시스템

- **이미지 유틸리티** (`image_utils.py`)
  - 이미지 다운로드
    - 비동기 다운로드
    - 재시도 로직
    - 에러 처리
  - 배경 제거
    - rembg 라이브러리 활용
    - GPU 가속 처리
    - 품질 설정
  - 이미지 포맷 변환
    - 포맷 자동 감지
    - 최적화된 변환
    - 메타데이터 보존

### 3. 데이터 처리
- **매칭 로직** (`matching_logic.py`)
  - 상품 매칭 알고리즘
    - 텍스트 기반 매칭
    - 이미지 기반 매칭
    - 가격 기반 매칭
  - 유사도 계산
    - Sentence-BERT 기반 텍스트 유사도
    - EfficientNet 기반 이미지 유사도
    - 가중치 기반 통합 점수
  - 결과 필터링
    - 임계값 기반 필터링
    - 카테고리별 최적화
    - 품질 평가

- **엑셀 처리** (`excel_utils.py`)
  - 엑셀 파일 생성
    - 이미지 임베딩
    - 서식 자동화
    - 대용량 처리
  - 이미지 임베딩
    - 이미지 크기 최적화
    - 위치 자동 조정
    - 메모리 관리
  - 데이터 포맷팅
    - 자동 열 너비
    - 조건부 서식
    - 필터링 및 정렬

### 4. 가격 분석
- **가격 하이라이팅** (`price_highlighter.py`)
  - 가격 비교 분석
    - 수량별 가격 비교
    - VAT 포함/미포함 처리
    - 할인율 계산
  - 가격 차이 하이라이팅
    - 차이 비율 계산
    - 색상 코드 적용
    - 임계값 기반 강조
  - 수량별 가격 정보 처리
    - 수량별 할인율 계산
    - 최적 수량 추천
    - 가격 추세 분석

### 5. 유틸리티
- **설정 관리** (`execution_setup.py`)
  - 환경 설정
    - GPU 메모리 관리
    - 병렬 처리 설정
    - 캐시 설정
  - 로깅 설정
    - 상세 로그 기록
    - 에러 추적
    - 성능 모니터링
  - 임시 파일 관리
    - 자동 정리
    - 디스크 공간 관리
    - 백업 처리

- **이메일 발송** (`email_sender.py`)
  - 결과 파일 이메일 발송
    - 대용량 파일 처리
    - 압축 및 첨부
    - 발송 상태 추적
  - 이메일 설정 검증
    - SMTP 설정 확인
    - 보안 설정
    - 발송 제한 관리

## 주요 파일 설명

### 핵심 파일
- `main_rpa.py`: 메인 실행 파일
  - 전체 프로세스 조율
  - 에러 처리 및 복구
  - 진행 상황 모니터링

- `crawl_naver_api.py`: 네이버 API 크롤링
  - API 요청 최적화
  - 결과 필터링
  - 이미지 처리

- `crawling_kogift.py`: 고기프트 크롤링
  - 웹 크롤링 로직
  - 데이터 추출
  - 이미지 처리

- `image_integration.py`: 이미지 통합 처리
  - 이미지 매칭
  - 유사도 계산
  - 결과 통합

- `matching_logic.py`: 상품 매칭 로직
  - 매칭 알고리즘
  - 유사도 계산
  - 결과 필터링

- `excel_utils.py`: 엑셀 처리 유틸리티
  - 파일 생성
  - 이미지 임베딩
  - 포맷팅

### 보조 파일
- `utils.py`: 공통 유틸리티 함수
  - 헬퍼 함수
  - 공통 로직
  - 유틸리티 클래스

- `data_processing.py`: 데이터 전처리
  - 데이터 정제
  - 형식 변환
  - 검증

- `price_highlighter.py`: 가격 분석
  - 가격 비교
  - 하이라이팅
  - 분석 로직

- `upload_filter.py`: 업로드 필터링
  - 데이터 필터링
  - 검증
  - 변환

- `excel_formatter.py`: 엑셀 포맷팅
  - 서식 적용
  - 스타일링
  - 레이아웃

## 설정 파일
- `config.ini`: 시스템 설정 파일
  - API 키 설정
    - 네이버 API 키
    - 기타 서비스 키
  - 크롤링 설정
    - 요청 간격
    - 타임아웃
    - 재시도 횟수
  - 이미지 처리 설정
    - GPU 사용
    - 배경 제거
    - 캐시 설정
  - 이메일 설정
    - SMTP 서버
    - 발신자 정보
    - 수신자 목록

## 사용 방법
1. `config.ini` 파일에 필요한 설정 입력
   - API 키 설정
   - 경로 설정
   - 처리 옵션 설정
2. `main_rpa.py` 실행
   - GUI 모드 또는 CLI 모드 선택
   - 입력 파일 선택
   - 처리 시작
3. 결과는 `C:\RPA\Output` 디렉토리에 저장
   - 엑셀 파일
   - 이미지 파일
   - 로그 파일

## 주의사항
- 네이버 API 키가 필요합니다
  - 개발자 센터에서 발급
  - 일일 요청 제한 확인
  - 키 보안 관리
- 이미지 처리를 위해 충분한 디스크 공간이 필요합니다
  - 최소 10GB 이상 권장
  - 임시 파일 자동 정리
  - 백업 공간 확보
- GPU가 있으면 이미지 처리 성능이 향상됩니다
  - CUDA 지원 GPU 권장
  - 최소 4GB VRAM
  - 드라이버 업데이트

## 의존성
- Python 3.7+
  - 비동기 처리 지원
  - 타입 힌팅 지원
  - 최신 라이브러리 호환
- pandas
  - 데이터 처리
  - 엑셀 입출력
  - 데이터 분석
- openpyxl
  - 엑셀 파일 생성
  - 이미지 임베딩
  - 서식 적용
- aiohttp
  - 비동기 HTTP 요청
  - 세션 관리
  - 타임아웃 처리
- playwright
  - 브라우저 자동화
  - 동적 페이지 처리
  - CAPTCHA 우회
- rembg
  - 이미지 배경 제거
  - GPU 가속
  - 품질 설정
- torch
  - 딥러닝 모델
  - GPU 가속
  - 이미지 처리

## 라이선스
이 프로젝트는 비공개 라이선스로 보호됩니다. 